"use strict";requirejs(["jquery","axios","Vimeo","jqueryTimer"],function(e,n,o){function t(){var e={loop:!1};m=new o("videoplayer",e),m.setVolume(.5),m.ready().then(function(){console.info("Player is ready."),m.getDuration().then(function(e){D=e,i()}).catch(function(e){console.error(e)}),q<D-5&&confirm("마지막 재생시점으로 이동하시겠습니까?")&&m.setCurrentTime(q).then(function(e){m.pause()}).catch(function(e){console.error(e)})}).catch(function(e){console.error(e)})}function i(){D?(h=e.timer(1e3*g,a,!0),h.stop(),r()):console.error("재생시간을 확인할 수 없습니다.")}function r(){s(S)}function s(e){Math.floor(D*(j/100))<=e&&x.removeClass("blind")}function a(){v+=g,m.getCurrentTime().then(function(n){e.ajax({type:"POST",url:"/video/log/playtime",data:{training_user_id:w,video_id:O,played_seconds:v,video_duration:D,currenttime:n}}).done(function(e){e.success?(v=0,S=e.total_played_seconds,s(S)):(console.error(e.msg),h.stop(),m.stop())})}).catch(function(e){console.error(e)})}function c(){e.ajax({type:"POST",url:"/video/log/endtime",data:{video_id:O}}).done(function(e){e.success||console.error(e.msg)})}function u(){e.ajax({type:"POST",url:"/session/log/starttime",data:{training_user_id:w,course_id:C,course_list_id:b}}).done(function(e){e.success?k=e.hasEnded:(console.error(e.msg),h.stop(),m.stop())})}function l(){e.ajax({type:"POST",url:"/session/log/endtime",data:{training_user_id:w,course_id:C,course_list_id:b}}).done(function(e){e.success?location.href=P:(console.error(e.msg),h.stop(),m.stop())})}function d(){T-=1,V.html(" ( "+T+" 초 이내 클릭 )"),T<=0&&(y.stop(),alert("비디오를 재시청 해주시기 바랍니다."),n.all([f(),p()]).then(n.spread(function(e,n){location.reload()})))}function f(){return n.delete("/video/log",{params:{video_id:O}}).then(function(e){}).catch(function(e){console.error(e)})}function p(){return n.delete("/session/log",{params:{training_user_id:w,course_list_id:b}}).then(function(e){}).catch(function(e){console.error(e)})}var m=null,_=e("#videoplayer"),g=_.data("interval"),h=null,y=null,v=0,T=_.data("wait-seconds"),j=_.data("passive-rate"),x=e(".btn_play"),P=x.parent().attr("href"),O=_.data("id"),S=_.data("total-play"),q=_.data("current-time"),w=x.data("training-user-id"),C=x.data("course-id"),b=x.data("course-list-id"),D=null,V=e(".wait-message"),k=!1;e(function(){t()}),x.on("click",function(e){e.preventDefault(),l()}),m.on("play",function(e){u(),h.reset(1e3*g)}),m.on("error",function(e){console.error(e)}),m.on("pause",function(e){h.pause(),c()}),m.on("ended",function(n){h.pause(),s(S+g),c(),k||setTimeout(function(){y=e.timer(1e3,d,!0)},3e3)})});