"use strict";requirejs(["jquery","axios","Vimeo","easyTimer","jqueryTimer"],function(e,n,o,t){function i(){var e={loop:!1};h=new o("videoplayer",e),h.setVolume(.5),h.ready().then(function(){console.info("Player is ready."),h.getDuration().then(function(e){T=e,r()}).catch(function(e){console.error(e)}),O<T-5&&window.confirm("마지막 재생시점으로 이동하시겠습니까?")&&h.setCurrentTime(O).then(function(e){h.pause()}).catch(function(e){console.error(e)})}).catch(function(e){console.error(e)})}function r(){T?(g=e.timer(1e3*v,c,!0),g.stop(),s()):console.error("재생시간을 확인할 수 없습니다.")}function s(){a(V)}function a(e){Math.floor(T*(w/100))<=e&&(C.removeClass("blind"),S.addClass("blind"))}function c(){y+=v,h.getCurrentTime().then(function(n){return m>0&&m===n?void h.pause().then(function(){console.log("비디오가 중지되었습니다."),S.removeClass("blind")}).catch(function(e){console.error(e)}):(m=n,void e.ajax({type:"POST",url:"/video/log/playtime",data:{training_user_id:q,video_id:P,played_seconds:y,video_duration:T,currenttime:n}}).done(function(e){e.success?(y=0,V=e.total_played_seconds,a(V)):(console.error(e.msg),h.pause().then(function(){}).catch(function(e){console.error(e)}))}))}).catch(function(e){console.error(e)})}function u(){e.ajax({type:"POST",url:"/video/log/endtime",data:{video_id:P}}).done(function(e){e.success||console.error(e.msg)})}function d(){e.ajax({type:"POST",url:"/session/log/starttime",data:{training_user_id:q,course_id:D,course_list_id:E}}).done(function(e){e.success?j=e.hasEnded:(console.error(e.msg),g.stop(),h.stop())})}function l(){e.ajax({type:"POST",url:"/session/log/endtime",data:{training_user_id:q,course_id:D,course_list_id:E}}).done(function(e){e.success?window.location.href=x:(console.error(e.msg),g.stop(),h.stop())})}function f(){return n.delete("/video/log",{params:{video_id:P}}).then(function(e){}).catch(function(e){console.error(e)})}function p(){return n.delete("/session/log",{params:{training_user_id:q,course_list_id:E}}).then(function(e){}).catch(function(e){console.error(e)})}var m,h=null,_=e(".videoplayer"),v=_.data("interval"),g=null,y=0,w=(_.data("wait-seconds"),_.data("passive-rate")),T=null,b=e("#countdown .values"),j=!1,C=e("#btn_play_next"),x=C.parent().attr("href"),S=e("#btn_replay_video"),P=_.data("id"),V=_.data("total-play"),O=_.data("current-time"),q=C.data("training-user-id"),D=C.data("course-id"),E=C.data("course-list-id"),k=new t;e(function(){i()}),C.on("click",function(e){e.preventDefault(),l()}),h.on("play",function(e){k.reset(),d(),g.reset(1e3*v)}),h.on("error",function(e){console.info("error!"),console.error(e)}),h.on("pause",function(e){console.info("player: pause"),g.pause(),u()}),h.on("ended",function(o){console.info("player: ended"),g.pause(),a(V+v),u(),j||setTimeout(function(){e(".timer").removeClass("blind"),k=new t,k.start({countdown:!0,startValues:{seconds:30}}),b.html(k.getTimeValues().toString()+" 초 이내 <b>다음</b> 버튼을 클릭해주세요."),k.addEventListener("secondsUpdated",function(e){b.html(k.getTimeValues().toString()+" 초 이내 <b>다음</b> 버튼을 클릭해주세요.")}),k.addEventListener("targetAchieved",function(e){b.html("학습 초기화 중입니다.."),setTimeout(function(){window.alert("30초 동안 다음 버튼을 누르지 않아 학습을 초기화 하였습니다.\n\n재시청 해주시기 바랍니다."),n.all([f(),p()]).then(n.spread(function(e,n){window.location.reload()}))},3e3)})},1e3)}),S.on("click",function(e){e.preventDefault(),h.unload().then(function(){S.addClass("blind")}).catch(function(e){console.log(e)})})});
//# sourceMappingURL=../maps/video.js.map
