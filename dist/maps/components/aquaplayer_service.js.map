{"version":3,"sources":["components/aquaplayer_service.js"],"names":["window","define","AquaPlayerService","options","extend","self","encodedParam","init","$","a","b","key","hasOwnProperty","extendOptions","getEncodedParam","resize","this","initPlayerHTML","html5","Util","getOSName","controlBox","player","NPlayer","initNPlayerUI","mode","setPlayerStart","mygentAuthCall","genkey","setMediaInfo","fileUrl","callback","indicateInstall","state","indicateUpdate","starthtml5State","OpenState","Opened","setVisible","bindEvent","Closed","Stophtml5State","PlayState","Playing","Stopped","Paused","reportMessage","name","desc","ec","initPlayerWindow","testWatermark","visible","addContextMenu","setCDNAuthParam","encodeURI","open","URL","setAxPlugin","val","console","AquaAxPlugin","LoadSystemInfomation","height","res","data","encparam","initPlayer","catch","err","reportError","msg","setWatermarkText","setWatermarkColor","setWatermarkInterval","testSubtitle","watermark","testSubtitle2","setTimeout","setSubtitleText","testSubtitle1","testSubtitle3","setSubtitleFont","setSubtitleColor","setSubtitlePosition"],"mappings":"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","file":"../../javascripts/components/aquaplayer_service.js","sourcesContent":["'use strict';\nwindow.define([\n  'common',\n  'axplugin',\n  'nplayer',\n  'nplayer_ui',\n  'cdnproxy',\n  'nplayer_conf'\n], function (Util, ax) {\n  var self = null;\n  var encodedParam;\n  var player;\n  var $ = $ || window.$;\n\n  function AquaPlayerService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  AquaPlayerService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getEncodedParam();\n      self.resize();\n    },\n    initPlayer: function () {\n      $(window).resize();\n\n      self.options.html5 = Util.getOSName() !== 'Windows';\n\n      if (self.options.html5) {\n        self.initPlayerHTML();\n      } else if ('ActiveXObject' in window) {\n        self.initPlayerWindow();\n      }\n    },\n    // Player 초기화\n    initPlayerHTML: function () {\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false,\n        mode: 'html5'\n      });\n\n      // player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        // self.reportMessage('ready');\n        window.setSecurePage(true);\n\n        window.proxy_init(function () {\n          // 1. video start set\n          window.setPlayerStart(true);\n          // 2. nplayer instance set\n          window.setNPlayer(player);\n          // 4. media info set\n          window.mygentAuthCall(function (genkey) {\n            window.setMediaInfo(self.options.fileUrl, genkey);\n\n            var url = window.getMediaURL(true);\n            player.open({\n              'URL': window.encodeURI(url)\n            });\n\n            // 외부 모듈에서 플레이어 이벤트를 감지하기 위한 용도\n            self.options.callback(player);\n          }, encodedParam);\n        }, window.indicateInstall, window.indicateUpdate);\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        // self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          window.starthtml5State();\n          break;\n        case window.NPlayer.OpenState.Closed:\n          window.Stophtml5State(window.NPlayer.OpenState.Closed);\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        // self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        self.reportMessage('GuardCallback - ' + name + ' : ' + desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        self.reportMessage('Error - ' + ec);\n      });\n    },\n    initPlayerWindow: function () {\n      // self.options.fileUrl = 'http://eng-media-02.cdngc.net/cdnlab/cs1/tsbox/CSS_1500k.mp4';\n\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false\n      });\n      var setAxPlugin = false;\n\n      player = player;\n      self.testWatermark();\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        // self.reportMessage('Ready');\n\n        player.setCDNAuthParam(encodedParam);\n        player.addContextMenu('SystemInfo', 'sysinfo');\n\n        // console.log(window.encodeURI(self.options.fileUrl));\n\n        player.open({\n          'URL': window.encodeURI(self.options.fileUrl)\n        });\n\n        // 외부 모듈에서 플레이어 이벤트를 감지하기 위한 용도\n        self.options.callback(player);\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        // self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          break;\n        case window.NPlayer.OpenState.Closed:\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        // self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n\n          // if (ax.isDup === true) {\n          //   player.stop();\n          //   window.alert(window.NPLAYER_DUP_MSG);\n          //   break;\n          // }\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Playing;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Paused;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        if (setAxPlugin === true) window.AquaAxPlugin.SendPVLog(name, desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        console.log('err', ec);\n        $('#video').css('background-image', 'none');\n      });\n\n      player.bindEvent('ContextMenu', function (val) {\n        if (val === 'sysinfo') {\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.LoadSystemInfomation();\n            window.alert(\n              'CPU 정보 : ' + window.AquaAxPlugin.DeviceCPU + '\\n' +\n              'MEM 정보 : ' + window.AquaAxPlugin.DeviceMem + '\\n' +\n              'GPU 정보 : ' + window.AquaAxPlugin.DeviceGPU + '\\n\\n' +\n              'IP 정보 : ' + window.AquaAxPlugin.DeviceIP + '\\n' +\n              'Mac 정보 : ' + window.AquaAxPlugin.DeviceMac + '\\n' +\n              'OS 정보 : ' + window.AquaAxPlugin.DeviceOSDesc + '\\n' +\n              '해상도 정보 : ' + window.AquaAxPlugin.DeviceMonitor + '\\n' +\n              'IE 버전 : ' + window.AquaAxPlugin.DeviceIE + '\\n'\n            );\n          }\n        }\n      });\n\n      window.onunload = function () {\n        if (setAxPlugin === true) window.AquaAxPlugin.FinalizeAuth();\n      };\n    },\n    // encparam 을 서버에서 생성하여 전달받는다.\n    getEncodedParam: function () {\n      window.axios.get('/api/v1/player/encparam')\n        .then(function (res) {\n          encodedParam = res.data.encparam;\n          // self.reportMessage(encodedParam);\n          self.initPlayer();\n        })\n        .catch(function (err) {\n          self.reportError(err);\n        }\n      );\n    },\n    reportMessage: function (msg) {\n      console.log('aquaservice : ' + msg);\n    },\n    reportError: function (err) {\n      console.log('aquaservice : ' + err);\n    },\n    resize: function () {\n      $(window).resize(function () {\n        $('#video').height($(window).height() - $('.wrapper_foot').height());\n        // if (player && !player.getFullscreen()) {\n        //   console.log('resized-1');\n        //   $('#video').height($(window).height());\n        // } else {\n        //   console.log('resized-2');\n        //   $('#video').height($(window).height() - $('.wrapper_foot').height());\n        // }\n      });\n    },\n    testWatermark () {\n      player.setWatermarkText(self.options.watermark);\n      player.setWatermarkSize(15);\n      player.setWatermarkColor(255, 0, 0, 0.5);\n      player.setWatermarkInterval(5);\n      player.setWatermarkLocation(22);\n    },\n    testSubtitle: function () {\n      self.testSubtitle1();\n    },\n    testSubtitle1: function () {\n      window.setTimeout(function () {\n        player.setSubtitleFont('궁서', 25);\n        player.setSubtitleColor(255, 0, 0, 0.5);\n        player.setSubtitlePosition(100, 100);\n        player.setSubtitleText('Hello, World - 테스트 1');\n        self.testSubtitle2();\n      }, 1000);\n    },\n    testSubtitle2: function () {\n      window.setTimeout(function () {\n        player.setSubtitleFont('Malgun Gothic', 15);\n        player.setSubtitleColor(0, 255, 0, 1);\n        player.setSubtitlePosition(200, 50);\n        player.setSubtitleText('Hello, World - 테스트 2');\n        self.testSubtitle3();\n      }, 1000);\n    },\n    testSubtitle3 () {\n      window.setTimeout(function () {\n        player.setSubtitleFont('굴림', 35);\n        player.setSubtitleColor(0, 0, 255, 0.7);\n        player.setSubtitlePosition(50, 200);\n        player.setSubtitleText('Hello, World - 테스트 3');\n        self.testSubtitle1();\n      }, 1000);\n    }\n  };\n\n  return AquaPlayerService;\n});\n"]}